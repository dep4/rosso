package ja3

import (
   "encoding/hex"
   "net/http"
   "os"
   "testing"
)

const (
   addr = "https://www.amazon.com/dp/B07K5214NZ"
   hello = "1603010200010001fc03034e60aa041091ddd48f4fd78c13701178b8a6d21c48b7763058e3651827df6ce620802137bf7b03f2a7aec3b80a0f8f8d5a0ab422cf555876ee7e529213bd13b5c2003e130213031301c02cc030009fcca9cca8ccaac02bc02f009ec024c028006bc023c0270067c00ac0140039c009c0130033009d009c003d003c0035002f00ff010001750000001d001b000018636c69656e742e746c7366696e6765727072696e742e696f000b000403000102000a000c000a001d0017001e00190018337400000010000e000c02683208687474702f312e31001600000017000000310000000d0030002e040305030603080708080809080a080b080408050806040105010601030302030301020103020202040205020602002b0009080304030303020301002d00020101003300260024001d00205fa3f5528396cfc59de1a34bc5208f5e87622179c797804423957b6eec3df661001500a5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
)

func TestParse(t *testing.T) {
   data, err := hex.DecodeString(hello)
   if err != nil {
      t.Fatal(err)
   }
   spec, err := ClientHello(data)
   if err != nil {
      t.Fatal(err)
   }
   req, err := http.NewRequest("GET", addr, nil)
   if err != nil {
      t.Fatal(err)
   }
   req.Header.Set("User-Agent", "Mozilla")
   res, err := NewTransport(spec).RoundTrip(req)
   if err != nil {
      t.Fatal(err)
   }
   defer res.Body.Close()
   os.Stdout.ReadFrom(res.Body)
}
